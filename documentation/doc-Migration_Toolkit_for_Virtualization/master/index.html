<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta name="google-site-verification" content="RUElhd5171Z1GQ5VA3nhWfpeXj4CnaYhbb4bRj1E75w" />
    <meta name="yandex-verification" content="650ce1b8e197bbb8" />
    <meta charset="UTF-8">
    <script src="//use.fontawesome.com/releases/v5.1.0/js/all.js" integrity="sha384-3LK/3kTpDE/Pkp8gTNp2gR/2gOiwQ6QaO7Td0zV76UFJVhqLl4Vl3KL1We6q6wR9" crossorigin="anonymous"></script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Forklift documentation</title>
    <!-- # Opengraph protocol properties: https://ogp.me/ -->
    <meta name="author" content="Red Hat Modernization and Migration Solutions documentation team" >
    <meta property="og:type" content="article" >
    <meta name="twitter:card" content="summary">
    <meta name="keywords" content="" >
    <meta property="og:type" content="website">
    <meta property="og:image" content="">
    <meta property="og:article:author" content="Red Hat Modernization and Migration Solutions documentation team" >
    <meta property="og:article:published_time" content="2021-01-26 18:13:30 -0600" >
    <meta name="twitter:title" content="Forklift documentation">
    <meta name="twitter:description" content="Forklift documentation">


<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Forklift documentation | Forklift documentation</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Forklift documentation" />
<meta name="author" content="Red Hat Modernization and Migration Solutions documentation team" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Forklift documentation" />
<meta property="og:description" content="Forklift documentation" />
<meta property="og:site_name" content="Forklift documentation" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Red Hat Modernization and Migration Solutions documentation team"},"url":"/forklift-documentation/documentation/doc-Migration_Toolkit_for_Virtualization/master/","description":"Forklift documentation","@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/forklift-documentation/assets/img/forklift-logo-lightbg.svg"},"name":"Red Hat Modernization and Migration Solutions documentation team"},"headline":"Forklift documentation","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/forklift-documentation/assets/css/style.css?v=773261377575a944d0dc092c87dc4c2f54dfad35">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        
          <img src="/forklift-documentation/assets/img/forklift-logo-lightbg.svg" alt="Logo" width="200" />
        

        <h1><a href="/forklift-documentation/">Forklift documentation</a></h1>

        <!-- <p>Forklift documentation</p> -->

        
        <p class="view"><a href="https://github.com/konveyor/forklift-documentation">View the Project on GitHub <small>konveyor/forklift-documentation</small></a></p>
        

        

        
      </header>
      <section>

      <h1>Installing and using Forklift</h1>
<div class="sect1">
<h2 id="making-open-source-more-inclusive">Making open source more inclusive</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat is committed to replacing problematic language in our code, documentation, and web properties. We are beginning with these four terms: master, slave, blacklist, and whitelist. Because of the enormity of this endeavor, these changes will be implemented gradually over several upcoming releases. For more details, see <a href="https://www.redhat.com/en/blog/making-open-source-more-inclusive-eradicating-problematic-language">our CTO Chris Wright&#8217;s message</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="about-mtv_forklift">About  Forklift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the Forklift custom resources, services, and workflows.</p>
</div>
<div class="sect2">
<h3 id="mtv-custom-crs-and-services_forklift">Forklift custom resources and services</h3>
<div class="paragraph">
<p> Forklift creates the following custom resources (CRs) and services.</p>
</div>
<div class="ulist">
<div class="title">Custom resources</div>
<ul>
<li>
<p>The <code>Provider</code> CRs store attributes that enable Forklift to connect to and interact with the source and target providers.</p>
</li>
<li>
<p>The <code>Mapping</code> CRs map the networks and storage of the source and target providers.</p>
</li>
<li>
<p>A <code>Plan</code> CR, also called a migration plan, contains a list of virtual VMs that are migrated together with the same migration parameters. The <code>Plan</code> selects VMs to fit the available migration resources until all VMs are migrated.</p>
</li>
<li>
<p>A <code>Migration</code> CR is created when you run a migration plan.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Services</div>
<ul>
<li>
<p>The <em>Provider Inventory</em> service connects to the source and target providers. It maintains a local inventory for mappings and plans. Each provider has its own <code>ProviderInventory</code> pod to ensure scalability.</p>
</li>
<li>
<p>The <em>Validation</em> service checks the suitability of a VM for migration by applying rules and stores the validation status. The Validation service is triggered by the Provider Inventory service whenever a VM configuration change is detected.</p>
</li>
<li>
<p>The <em>User Interface</em> service enables you to create and configure Forklift CRs. It also displays the status of the CRs and the progress of a migration.</p>
</li>
<li>
<p>The <em>Migration Controller</em>, <em>Virtual Machine Import Controller</em>, <em>Kubevirt Controller</em>, and <em>Containerized Data Import (CDI) Controller</em> services implement the logic to reconcile the CRs with the state defined by the user. Controllers perform actions with CRs in response to user requests.</p>
<div class="paragraph">
<p>For example, when you create a migration plan, the Migration Controller validates the plan and adds a status label. If the plan fails validation, its status is <code>Not ready</code> and the plan cannot be used to perform a migration. If the plan passes validation, its status is <code>Ready</code> and it can be used to perform a migration. After the migration, the Migration Controller changes the plan status to <code>Completed</code>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="mtv-workflows_forklift">Forklift workflows</h3>
<div class="paragraph">
<p>This section describes the Forklift and KubeVirt workflows for migrating virtual machines (VMs). These steps assume that you are performing the migration using the Forklift console but you can also perform these steps using the CLI.</p>
</div>
<div class="paragraph">
<p>The power state of a source VM is maintained after migration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These diagrams are in progress.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../modules/images/mtv-workflow.png" alt="Forklift workflow" width="800">
</div>
<div class="title">Figure 1. Forklift workflow</div>
</div>
<div class="paragraph">
<p>The Forklift workflow comprises the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You create a source provider, a target provider, a network mapping, and a storage mapping.</p>
</li>
<li>
<p>You create a migration plan that includes the following resources:</p>
<div class="ulist">
<ul>
<li>
<p>Source provider</p>
</li>
<li>
<p>Target provider</p>
</li>
<li>
<p>Network mapping</p>
</li>
<li>
<p>Storage mapping</p>
</li>
<li>
<p>One or more VMs</p>
</li>
</ul>
</div>
</li>
<li>
<p>You run a migration plan. Each time you run a migration plan, the plan creates a <code>Migration</code> CR. If a migration is incomplete, you can run a migration plan multiple times until all VMs are migrated.</p>
</li>
<li>
<p>For each VM in the migration plan, the <em>Migration Controller</em> creates a <code>VirtualMachineImport</code> CR and monitors its status. When all VMs have been migrated, the Migration Controller sets the status of the migration plan to <code>Completed</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../modules/images/ocp-virt-workflow.png" alt="KubeVirt workflow" width="800">
</div>
<div class="title">Figure 2. KubeVirt workflow</div>
</div>
<div class="paragraph">
<p>The KubeVirt workflow comprises the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When you run a migration plan, the <em>Migration Controller</em> creates a <code>VirtualMachineImport</code> CR for each source VM.</p>
</li>
<li>
<p>The <em>Virtual Machine Import Controller</em> validates the <code>VirtualMachineImport</code> CR and generates a <code>VirtualMachine</code> CR and a <code>VirtualMachineInstance</code> CR.</p>
</li>
<li>
<p>The Virtual Machine Import Controller retrieves the VM configuration, including network, storage, and metadata, linked in the <code>VirtualMachineImport</code> CR.  </p>
<div class="paragraph">
<p><em>For each VM disk:</em></p>
</div>
</li>
<li>
<p>The Virtual Machine Import Controller creates a <code>DataVolume</code> CR as a wrapper for the Persistent Volume Claim (PVC) and annotations.  </p>
</li>
<li>
<p>The <em>Containerized Data Importer (CDI) Controller</em> creates a PVC. The Persistent Volume (PV) is dynamically provisioned by the <code>StorageClass</code> provisioner.  </p>
</li>
<li>
<p>The CDI Controller creates an <code>Importer</code> pod. The <code>Importer</code> pod connects to the source VM disk, by using the VDDK SDK, and streams the disk to the PV.</p>
</li>
<li>
<p>After the VM disks are transferred, the Virtual Machine Import Controller creates a <code>Conversion</code> pod that runs <code>virt-v2v</code> with all the PVCs attached to it.</p>
</li>
<li>
<p>When the VM is powered on, the KubeVirt Controller creates a <code>VirtualMachineInstance</code> that runs the <code>QEMU-KVM</code> process with the PVCs attached as VM disks.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-mtv_forklift">Installing  Forklift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can install  Forklift using the OpenShift Kubernetes Engine web console or the command line interface (CLI).</p>
</div>
<div class="paragraph">
<p>You must create a VMware Virtual Disk Development Kit (VDDK) image and add it to a config map. Forklift uses VDDK to copy the source VM disks.</p>
</div>
<div class="sect2">
<h3 id="installing-mtv-console_forklift">Installing  Forklift using the web console</h3>
<div class="paragraph">
<p>You can install  Forklift using the OpenShift Kubernetes Engine web console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install OpenShift Kubernetes Engine 4.6 on your cluster.</p>
</li>
<li>
<p>Install the KubeVirt Operator.</p>
</li>
<li>
<p>Log in as a user with <code>cluster-admin</code> privileges.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open a browser window and log in to the OpenShift Kubernetes Engine web console.</p>
</li>
<li>
<p>Click <strong>Operators</strong> &#8594; <strong>OperatorHub</strong>.</p>
</li>
<li>
<p>Click the Operator and then click <strong>Install</strong>.</p>
</li>
<li>
<p>On the <strong>Install Operator</strong> page, click <strong>Install</strong>.</p>
<div class="paragraph">
<p>On the <strong>Installed Operators</strong> page, the Operator appears in the <strong>openshift-migration</strong> project with the status <strong>Succeeded</strong>.</p>
</div>
</li>
<li>
<p>Click the Operator.</p>
</li>
<li>
<p>Under <strong>Provided APIs</strong>, locate the <strong>VirtController</strong> tile, and click <strong>Create Instance</strong>.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
<li>
<p>Click <strong>Workloads</strong> &#8594; <strong>Pods</strong> to verify that the <code>ProviderInventory</code>, <code>Validation</code>, <code>UserInterface</code>, and <code>Controller</code> pods are running.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="installing-mtv-cli_forklift">Installing  Forklift using the CLI</h3>
<div class="paragraph">
<p>You can install  Forklift using the command line interface (CLI).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install OpenShift Kubernetes Engine 4.6 on your cluster.</p>
</li>
<li>
<p>Install the KubeVirt Operator.</p>
</li>
<li>
<p>Install the <a href="https://docs.openshift.com/container-platform/4.6/cli_reference/openshift_cli/getting-started-cli.html">OpenShift CLI</a>.</p>
</li>
<li>
<p>Log in as a user with <code>cluster-admin</code> privileges.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an <code>openshift-migration</code> project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &lt;&lt; EOF | oc apply -f -
---
apiVersion: project.openshift.io/v1
kind: Project
metadata:
  name: openshift-migration
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>Create an <code>OperatorGroup</code> object called <code>migration</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &lt;&lt; EOF | oc apply -f -
---
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: migration
  namespace: openshift-migration
spec:
  targetNamespaces:
    - openshift-migration
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>Subscription</code> object for the <code>virt-operator</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &lt;&lt; EOF | oc apply -f -
---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: virt-operator
  namespace: openshift-migration
spec:
  channel: development
  installPlanApproval: Automatic
  name: virt-operator
  source: konveyor-for-vms
  sourceNamespace: openshift-marketplace
  startingCSV: "konveyor-virt-operator.v99.0.0"
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>VirtController</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &lt;&lt; EOF | oc apply -f -
---
apiVersion: virt.konveyor.io/v1alpha1
kind: VirtController
metadata:
  name: virt-controller
  namespace: openshift-migration
spec:
  olm_managed: true
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>View the resources created by the <code>VirtController</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc get pods -n openshift-migration</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre>TBD</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-vddk-to-mtv_forklift">Adding a VDDK image to Forklift</h3>
<div class="paragraph">
<p>You can create a VDDK image and store it in a private image registry. Then, you can add the image to the <code>v2v-vmware</code> config map.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Storing the VDDK image in a public registry might violate the terms of the VMware license.</p>
</div>
</td>
</tr>
</table>
</div>
<h4 id="prerequisites" class="discrete">Prerequisites</h4>
<div class="ulist">
<ul>
<li>
<p>An internal <a href="https://docs.openshift.com/container-platform/4.6/registry/configuring_registry_storage/configuring-registry-storage-baremetal.html">OpenShift Kubernetes Engine image registry</a> or a secure <a href="https://docs.openshift.com/container-platform/4.6/registry/registry-options.html">external registry</a></p>
</li>
<li>
<p>Access to the image registry from your KubeVirt environment</p>
</li>
<li>
<p>Podman installed</p>
</li>
</ul>
</div>
<h4 id="procedure" class="discrete">Procedure</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create and navigate to a temporary directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ mkdir /tmp/&lt;dir_name&gt; &amp;&amp; cd /tmp/&lt;dir_name&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In a browser, navigate to <a href="https://code.vmware.com/home">VMware code</a> and click <strong>SDKs</strong>.</p>
</li>
<li>
<p>In the <strong>Compute Virtualization</strong> section, click <strong>Virtual Disk Development Kit (VDDK)</strong>.</p>
</li>
<li>
<p>Select the VDDK version that corresponds to your VMware vSphere version, for example, VDDK 7.0 for vSphere 7.0.</p>
</li>
<li>
<p>Click <strong>Download</strong> and save the VDDK archive in the temporary directory.</p>
</li>
<li>
<p>Extract the VDDK archive:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ tar -xzf VMware-vix-disklib-&lt;version&gt;.x86_64.tar.gz</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>Dockerfile</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &gt; Dockerfile &lt;&lt;EOF
FROM busybox:latest
COPY vmware-vix-disklib-distrib /vmware-vix-disklib-distrib
RUN mkdir -p /opt
ENTRYPOINT ["cp", "-r", "/vmware-vix-disklib-distrib", "/opt"]
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>Build the VDDK image:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ podman build . -t &lt;registry_route_or_server_path&gt;/vddk:&lt;tag&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify your image registry:
<div class="ulist">
<ul>
<li>
<p>For an internal OpenShift Kubernetes Engine registry, specify the internal registry route, for example, <code>image-registry.openshift-image-registry.svc:5000/openshift/vddk:&lt;tag&gt;</code>.</p>
</li>
<li>
<p>For an external registry, specify the server name, path, and tag, for example, <code>server.example.com:5000/vddk:&lt;tag&gt;</code>.</p>
</li>
</ul>
</div></td>
</tr>
</table>
</div>
</li>
<li>
<p>Push the VDDK image to the registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ podman push &lt;registry_route_or_server_path&gt;/vddk:&lt;tag&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>v2v-vmware</code> config map in the <strong>openshift-cnv</strong> project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc edit configmap v2v-vmware -n openshift-cnv</code></pre>
</div>
</div>
</li>
<li>
<p>Add the <code>vddk-init-image</code> parameter to the <code>data</code> stanza:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">...
data:
  vddk-init-image: &lt;registry_route_or_server_path&gt;/vddk:&lt;tag&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrating-virtual-machines_forklift">Migrating virtual machines</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can migrate virtual machines using the OpenShift Kubernetes Engine web console or the CLI.</p>
</div>
<div class="sect2">
<h3 id="migrating-vms-web-console_forklift">Migrating virtual machines with the web console</h3>
<div class="paragraph">
<p>You can add providers and create network and storage mappings. Then, you create and run a migration plan.</p>
</div>
<div class="sect3">
<h4 id="adding-providers_forklift">Adding providers</h4>
<div class="paragraph">
<p>You can add the KubeVirt and VMware providers in the web console.</p>
</div>
<div class="sect4">
<h5 id="adding-virt-provider_forklift">Adding the KubeVirt provider</h5>
<div class="paragraph">
<p>You can add the KubeVirt provider by using the Forklift web console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.6/authentication/using-service-accounts-in-applications.html"><code>VirtController</code> service account token</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the web console, navigate to <strong>Providers</strong> and click <strong>Add provider</strong>.</p>
</li>
<li>
<p>Select <strong>KubeVirt</strong> from the <strong>Type</strong> list.</p>
</li>
<li>
<p>Fill in the following fields:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Cluster name</strong>: OpenShift cluster name to display in the list of providers</p>
</li>
<li>
<p><strong>URL</strong>: OpenShift cluster API endpoint</p>
</li>
<li>
<p><strong>Service account token</strong>: VirtController service account token</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Check connection</strong> to verify the credentials.</p>
</li>
<li>
<p>Click <strong>Add</strong> to add and save the provider.</p>
<div class="paragraph">
<p>The provider appears in the list of providers.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="adding-vmware-provider_forklift">Adding the VMware provider</h5>
<div class="paragraph">
<p>You can add the VMware provider by using the Forklift web console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Admin privileges</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the web console, navigate to <strong>Providers</strong> and click <strong>Add provider</strong>.</p>
</li>
<li>
<p>Select <strong>VMware</strong> from the <strong>Type</strong> list.</p>
</li>
<li>
<p>Fill in the following fields:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong>: vCenter name to display in the list of providers</p>
</li>
<li>
<p><strong>Hostname</strong>: vCenter host name or IP address</p>
</li>
<li>
<p><strong>Username</strong>: vCenter admin user name, for example, <code>administrator@vsphere.local</code></p>
</li>
<li>
<p><strong>Password</strong>: vCenter password</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Check connection</strong> to verify the credentials.</p>
</li>
<li>
<p>Click <strong>Add</strong> to add and save the provider.</p>
<div class="paragraph">
<p>The provider appears in the list of providers.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-mappings_forklift">Creating mappings</h4>
<div class="paragraph">
<p>You can create mappings to map the source and target networks and storage.</p>
</div>
<div class="sect4">
<h5 id="creating-network-mapping_forklift">Creating a network mapping</h5>
<div class="paragraph">
<p>You can create a network mapping to map source networks to KubeVirt networks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot map an opaque network to a KubeVirt network.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the web console, navigate to <strong>Mappings</strong> &#8594; <strong>Network</strong>.</p>
</li>
<li>
<p>Click <strong>Create mapping</strong>.</p>
</li>
<li>
<p>Select a <strong>Source provider</strong> and a <strong>Target provider</strong>.</p>
</li>
<li>
<p>Select a network from the <strong>Source networks</strong> list and from the <strong>Target networks</strong> list.</p>
</li>
<li>
<p>Click <strong>Add</strong> to create additional network mappings or to map multiple source networks to a single target network.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
<div class="paragraph">
<p>The mapping is displayed in the <strong>Network mappings</strong> list.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="creating-storage-mapping_forklift">Creating a storage mapping</h5>
<div class="paragraph">
<p>You can create a storage mapping to map data stores to KubeVirt storage classes.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The local and shared persistent storage must support VM migration.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the web console, navigate to <strong>Mappings</strong> &#8594; <strong>Storage</strong>.</p>
</li>
<li>
<p>Click <strong>Create mapping</strong>.</p>
</li>
<li>
<p>Select a <strong>Source provider</strong> and a <strong>Target provider</strong>.</p>
</li>
<li>
<p>Select a data store from the <strong>Source datastores</strong> list and a storage class from the <strong>Target storage classes</strong> list.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the source storage does not support <a href="https://docs.openshift.com/container-platform/4.6/storage/dynamic-provisioning.html">dynamic provisioning</a>, the default settings, <code>Filesystem</code> volume mode and <code>ReadWriteOnce</code> access mode, are applied. <code>Filesystem</code> volume mode is slower than <code>Block</code> volume mode. <code>ReadWriteOnce</code> access mode does not allow live VM migration.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Add</strong> to create additional storage mappings or to map multiple data stores to a single storage class.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
<div class="paragraph">
<p>The mapping is displayed in the <strong>Storage mappings</strong> list.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-migration-plan_forklift">Creating a migration plan</h4>
<div class="paragraph">
<p>You can create a migration plan in the Forklift web console.</p>
</div>
<div class="paragraph">
<p>A migration plan allows you to group virtual machines that should be migrated together or with the same migration parameters, for example, a percentage of the members of a cluster or a complete application.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The migration network supports migration.</p>
</li>
<li>
<p>The web console has source and target providers.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the web console, navigate to <strong>Migration plans</strong> and click <strong>Create migration plan</strong>.</p>
</li>
<li>
<p>Fill in the following fields in the <strong>General settings</strong> screen:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Plan name</strong>: Plan name that is displayed in the web console.</p>
</li>
<li>
<p><strong>Plan description</strong>: Optional. Brief description of the migration plan.</p>
</li>
<li>
<p><strong>Source provider</strong>: Select a VMware provider.</p>
</li>
<li>
<p><strong>Target provider</strong>: Select the KubeVirt provider.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Filter the VMs that you want to migrate by selecting data centers, clusters, or folders.</p>
</li>
<li>
<p>Select the VMs to migrate. You can click each VM to view its migration risk assessment.</p>
</li>
<li>
<p>Select an existing storage mapping or create a new storage mapping.</p>
</li>
<li>
<p>If you want to create a new storage mapping:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select a data store from the <strong>Source datastores</strong> list and a storage class from the <strong>Target storage classes</strong> list.</p>
</li>
<li>
<p>Click <strong>Add</strong> to create additional storage mappings or to map multiple data stores to a single storage class.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Select an existing network mapping or create a new network mapping.</p>
</li>
<li>
<p>If you want to create a new network mapping:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select a network from the <strong>Source networks</strong> list and a network from the <strong>Target networks</strong> list.</p>
</li>
<li>
<p>Click <strong>Add</strong> to create additional network mappings or to map multiple source networks to a single target network.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Review your migration plan and click <strong>Finish</strong>.</p>
<div class="paragraph">
<p>The migration plan is saved in the migration plan list.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="running-migration-plan_forklift">Running a migration plan</h4>
<div class="paragraph">
<p>You can run a migration plan and view its progress in the web console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The VMware VMs must be powered off.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the web console, navigate to <strong>Migration plans</strong>.</p>
<div class="paragraph">
<p>The <strong>Migration plans</strong> list displays the source and target providers, the number of VMs being migrated, the status of the plan, and a high-level progress bar that shows how many VMs have been migrated.</p>
</div>
</li>
<li>
<p>Click <strong>Start</strong> beside a migration plan with a <strong>Ready</strong> status to run the plan.</p>
</li>
<li>
<p>To view the <strong>Migration Details by VM</strong> screen, click the name of a migration plan.</p>
<div class="paragraph">
<p>This screen displays the migration start and end time, the amount of data copied, and a progress pipeline for each VM being migrated.</p>
</div>
</li>
<li>
<p>Expand a VM to view the migration steps, elapsed time of each step, and the state.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-virtual-machines-cli_forklift">Migrating virtual machines from the CLI</h3>
<div class="paragraph">
<p>You can migrate virtual machines from the command line (CLI) by creating the following custom resources (CRs):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Secret</code> CR contains the VMware provider credentials.</p>
</li>
<li>
<p><code>Provider</code> CR specifies the VMware provider.</p>
</li>
<li>
<p><code>Plan</code> CR specifies the source and target clusters, network mappings, data store mappings, and VMs to migrate.</p>
</li>
<li>
<p><code>Migration</code> CR runs the <code>Plan</code> CR.</p>
<div class="paragraph">
<p>If a migration does not complete, you can create a new <code>Migration</code> CR, without changing the <code>Plan</code> CR, to migrate the remaining VMs.</p>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install OpenShift Kubernetes Engine 4.6 on your cluster.</p>
</li>
<li>
<p>Install the KubeVirt Operator.</p>
</li>
<li>
<p>Install the <a href="https://docs.openshift.com/container-platform/4.6/cli_reference/openshift_cli/getting-started-cli.html">OpenShift CLI</a>.</p>
</li>
<li>
<p>Log in as a user with <code>cluster-admin</code> privileges.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Get the SSL thumbprint of the vCenter host:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ openssl s_client \
    -connect &lt;vcenter.example.com&gt;:443 \ <i class="conum" data-value="1"></i><b>(1)</b>
    &lt; /dev/null 2&gt;/dev/null \
    | openssl x509 -fingerprint -noout -in /dev/stdin \
    | cut -d '=' -f 2</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the vCenter host name.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a <code>Secret</code> CR with the VMware credentials:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &lt; EOF | oc apply -f -
---
apiVersion: v1
kind: Secret
metadata:
  name: vmware-secret
  namespace: openshift-migration
type: Opaque
stringData:
  user: administrator@vsphere.local
  password: &lt;password&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  thumbprint: &lt;01:23:45:67:89:AB:CD:EF:01:23:45:67:89:AB:CD:EF:01:23:45:67&gt; <i class="conum" data-value="2"></i><b>(2)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the password.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the thumbprint.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a <code>Provider</code> CR for VMware vSphere:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &lt; EOF | oc apply -f -
---
apiVersion: virt.konveyor.io/v1alpha1
kind: Provider
metadata:
  name: vmware-provider
  namespace: openshift-migration
spec:
  type: vsphere
  url: https://&lt;vcenter.example.com&gt;/sdk <i class="conum" data-value="1"></i><b>(1)</b>
  secret:
    name: vmware-secret <i class="conum" data-value="2"></i><b>(2)</b>
    namespace: openshift-migration
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the vSphere API end point.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the <code>Secret</code>.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a <code>Plan</code> CR for the migration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &lt; EOF | oc apply -f -
---
apiVersion: virt.konveyor.io/v1alpha1
kind: Plan
metadata:
  name: test-migration-plan
  namespace: openshift-migration
spec:
  provider:
    source:
      name: vmware-provider
      namespace: openshift-migration
    destination:
      name: host <i class="conum" data-value="1"></i><b>(1)</b>
      namespace: openshift-migration
  map:
    networks:
      - source:
          id: &lt;network-31&gt; <i class="conum" data-value="2"></i><b>(2)</b>
        destination:
          type: pod
          name: pod
          namespace: openshift-migration
      - source:
          id: &lt;network-723&gt;
        destination:
          type: pod
          name: pod
          namespace: openshift-migration
    datastores:
      - source:
          id: &lt;datastore-30&gt; <i class="conum" data-value="3"></i><b>(3)</b>
        destination:
          storageClass: standard
      - source:
          id: &lt;datastore-35&gt;
        destination:
          storageClass: standard
  vms:
    - id: &lt;vm-1630&gt; <i class="conum" data-value="4"></i><b>(4)</b>
    - id: &lt;vm-2841&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The OpenShift provider is added automatically as <code>host</code> when the Operator is deployed.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify a source network.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify a source data store.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify the IDs of the VMs to migrate.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a <code>Migration</code> CR to run the <code>Plan</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &lt; EOF | oc apply -f -
---
apiVersion: virt.konveyor.io/v1alpha1
kind: Migration
metadata:
  name: migration-test-001
  namespace: openshift-migration
spec:
  plan:
    name: test-migration-plan
    namespace: openshift-migration
EOF</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>Migration</code> CR creates a <code>VirtualMachineImport</code> CR for each VM being migrated. You can monitor the progress of the migration by viewing the <code>VirtualMachineImport</code> pods in the <code>openshift-migration</code> namespace.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshooting_forklift">Troubleshooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="collecting-logs_forklift">Collecting logs - to do</h3>
<div class="paragraph">
<p>TBD</p>
</div>
</div>
</div>
</div>

      </section>
      <footer>
        
        <p>This project is maintained by <a href="https://github.com/konveyor">konveyor</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/forklift-documentation/assets/js/scale.fix.js"></script>
    
  </body>
</html>
